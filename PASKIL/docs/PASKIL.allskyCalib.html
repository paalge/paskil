
<!doctype html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><title>Python: module PASKIL.allskyCalib</title>
</head><body bgcolor="#f0f0f8">

<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="heading">
<tr bgcolor="#7799ee">
<td valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial">&nbsp;<br><big><big><strong><a href="PASKIL.html"><font color="#ffffff">PASKIL</font></a>.allskyCalib</strong></big></big></font></td
><td align=right valign=bottom
><font color="#ffffff" face="helvetica, arial"><a href=".">index</a><br><a href="file:/home/nialp/workspace/PASKIL/docs/PASKIL/allskyCalib.py">/home/nialp/workspace/PASKIL/docs/PASKIL/allskyCalib.py</a></font></td></tr></table>
    <p><tt>Introduction:<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;allskyCalib&nbsp;module&nbsp;provides&nbsp;functions&nbsp;and&nbsp;classes&nbsp;for&nbsp;applying&nbsp;flat&nbsp;field&nbsp;corrections&nbsp;to&nbsp;all-sky&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;images.&nbsp;The&nbsp;sensitivity&nbsp;of&nbsp;a&nbsp;camera&nbsp;CCD&nbsp;is&nbsp;dependant&nbsp;on&nbsp;the&nbsp;incident&nbsp;angle&nbsp;of&nbsp;the&nbsp;incoming&nbsp;photon.&nbsp;As&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;result,&nbsp;when&nbsp;using&nbsp;a&nbsp;wide&nbsp;field&nbsp;of&nbsp;view&nbsp;(such&nbsp;as&nbsp;a&nbsp;fish&nbsp;eye&nbsp;lens),&nbsp;the&nbsp;edges&nbsp;of&nbsp;the&nbsp;field&nbsp;of&nbsp;view&nbsp;will&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tend&nbsp;to&nbsp;be&nbsp;darker&nbsp;than&nbsp;the&nbsp;center.&nbsp;Applying&nbsp;a&nbsp;flat&nbsp;field&nbsp;correction&nbsp;helps&nbsp;to&nbsp;negate&nbsp;this&nbsp;effect.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
Concepts:<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;There&nbsp;are&nbsp;two&nbsp;approaches&nbsp;to&nbsp;<a href="#calibration">calibration</a>.&nbsp;The&nbsp;first&nbsp;uses&nbsp;an&nbsp;absolute&nbsp;<a href="#calibration">calibration</a>,&nbsp;converting&nbsp;the&nbsp;intensity<br>
&nbsp;&nbsp;&nbsp;&nbsp;recorded&nbsp;by&nbsp;the&nbsp;CCD&nbsp;into&nbsp;Rayleighs&nbsp;and&nbsp;correcting&nbsp;for&nbsp;spatial/angular&nbsp;differences&nbsp;in&nbsp;sensitivity.&nbsp;This&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;requires&nbsp;data&nbsp;collected&nbsp;in&nbsp;a&nbsp;<a href="#calibration">calibration</a>&nbsp;lab.&nbsp;PASKIL&nbsp;allows&nbsp;such&nbsp;a&nbsp;<a href="#calibration">calibration</a>&nbsp;to&nbsp;be&nbsp;performed&nbsp;using&nbsp;the&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#-fromFile">fromFile</a>()&nbsp;function&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;<a href="#calibration">calibration</a>&nbsp;data.&nbsp;The&nbsp;second&nbsp;method&nbsp;does&nbsp;not&nbsp;require&nbsp;any&nbsp;<a href="#calibration">calibration</a>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;to&nbsp;be&nbsp;recoreded&nbsp;in&nbsp;a&nbsp;lab.&nbsp;It&nbsp;works&nbsp;by&nbsp;finding&nbsp;images&nbsp;recorded&nbsp;by&nbsp;the&nbsp;camera&nbsp;where&nbsp;the&nbsp;sky&nbsp;was&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;approximately&nbsp;evenly&nbsp;lit.&nbsp;By&nbsp;looking&nbsp;at&nbsp;the&nbsp;angular&nbsp;dependance&nbsp;of&nbsp;the&nbsp;intensity&nbsp;in&nbsp;such&nbsp;an&nbsp;image,&nbsp;an&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;estimate&nbsp;of&nbsp;the&nbsp;flat&nbsp;field&nbsp;<a href="#calibration">calibration</a>&nbsp;can&nbsp;be&nbsp;made.&nbsp;This&nbsp;method&nbsp;has&nbsp;two&nbsp;main&nbsp;stages;&nbsp;finding&nbsp;evenly&nbsp;lit&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;images&nbsp;and&nbsp;calculating&nbsp;the&nbsp;angluar&nbsp;dependance&nbsp;of&nbsp;the&nbsp;intensity.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;first&nbsp;stage&nbsp;is&nbsp;achieved&nbsp;by&nbsp;looking&nbsp;for&nbsp;images&nbsp;which&nbsp;have&nbsp;a&nbsp;small&nbsp;<a href="#variance">variance</a>&nbsp;in&nbsp;intensity.&nbsp;PASKIL&nbsp;provides<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;<a href="#-calculateVariances">calculateVariances</a>()&nbsp;function&nbsp;for&nbsp;this&nbsp;purpose.&nbsp;Having&nbsp;plotted&nbsp;the&nbsp;variances&nbsp;of&nbsp;your&nbsp;data&nbsp;set,&nbsp;you&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;look&nbsp;for&nbsp;time&nbsp;periods&nbsp;of&nbsp;low&nbsp;<a href="#variance">variance</a>&nbsp;and&nbsp;create&nbsp;a&nbsp;new&nbsp;data&nbsp;set&nbsp;containing&nbsp;only&nbsp;these&nbsp;images.&nbsp;This<br>
&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;set&nbsp;can&nbsp;then&nbsp;be&nbsp;analysed&nbsp;image&nbsp;by&nbsp;image&nbsp;and&nbsp;the&nbsp;angular&nbsp;dependance&nbsp;of&nbsp;CCD&nbsp;sensitivity&nbsp;estimated&nbsp;using&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;<a href="#-fromImages">fromImages</a>()&nbsp;function.<br>
&nbsp;<br>
Example:<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;the&nbsp;following&nbsp;example&nbsp;a&nbsp;set&nbsp;of&nbsp;images&nbsp;in&nbsp;a&nbsp;directory&nbsp;called&nbsp;"<a href="#calibration">calibration</a>&nbsp;images"&nbsp;are&nbsp;used&nbsp;to&nbsp;produce&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;flat&nbsp;field&nbsp;<a href="#calibration">calibration</a>&nbsp;data.&nbsp;This&nbsp;is&nbsp;then&nbsp;applied&nbsp;to&nbsp;the&nbsp;image&nbsp;"test.png".&nbsp;The&nbsp;images&nbsp;in&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;"<a href="#calibration">calibration</a>&nbsp;images"&nbsp;would&nbsp;have&nbsp;been&nbsp;chosen&nbsp;by&nbsp;using&nbsp;<a href="#variance">variance</a>.plot()&nbsp;and&nbsp;finding&nbsp;a&nbsp;time&nbsp;period&nbsp;with&nbsp;a&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;low&nbsp;<a href="#variance">variance</a>.<br>
&nbsp;<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;PASKIL&nbsp;import&nbsp;allskyImage,allskyCalib,allskyData&nbsp;#import&nbsp;the&nbsp;modules<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#create&nbsp;dataset&nbsp;object&nbsp;containing&nbsp;the&nbsp;<a href="#calibration">calibration</a>&nbsp;images<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;calibration_dataset&nbsp;=&nbsp;allskyData.new("<a href="#calibration">calibration</a>&nbsp;images","630",["png"],site_info_file="site_info.txt")&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#calibration">calibration</a>&nbsp;=&nbsp;allskyCalib.<a href="#-fromImages">fromImages</a>(calibration_dataset)&nbsp;#create&nbsp;<a href="#calibration">calibration</a>&nbsp;object<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image&nbsp;=&nbsp;allskyImage.new("test.png",site_info_file="site_info.txt")&nbsp;#create&nbsp;allskyImage&nbsp;object<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image&nbsp;=&nbsp;image.flatFieldCorrection(<a href="#calibration">calibration</a>)&nbsp;#apply&nbsp;flat&nbsp;field&nbsp;correction<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image.save("test_out.png")&nbsp;#save&nbsp;corrected&nbsp;image</tt></p>
<p>
<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="section">
<tr bgcolor="#aa55cc">
<td colspan=3 valign=bottom>&nbsp;<br>
<font color="#fffff" face="helvetica, arial"><big><strong>Modules</strong></big></font></td></tr>
    
<tr><td bgcolor="#aa55cc"><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt></td><td>&nbsp;</td>
<td width="100%"><table width="100%" summary="list"><tr><td width="25%" valign=top><a href="PIL.Image.html">PIL.Image</a><br>
<a href="calendar.html">calendar</a><br>
</td><td width="25%" valign=top><a href="datetime.html">datetime</a><br>
<a href="PASKIL.misc.html">PASKIL.misc</a><br>
</td><td width="25%" valign=top><a href="PASKIL.stats.html">PASKIL.stats</a><br>
</td><td width="25%" valign=top></td></tr></table></td></tr></table><p>
<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="section">
<tr bgcolor="#ee77aa">
<td colspan=3 valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial"><big><strong>Classes</strong></big></font></td></tr>
    
<tr><td bgcolor="#ee77aa"><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt></td><td>&nbsp;</td>
<td width="100%"><dl>
<dt><font face="helvetica, arial"><a href="PASKIL.allskyCalib.html#calibration">calibration</a>
</font></dt><dt><font face="helvetica, arial"><a href="PASKIL.allskyCalib.html#variance">variance</a>
</font></dt></dl>
 <p>
<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="section">
<tr bgcolor="#ffc8d8">
<td colspan=3 valign=bottom>&nbsp;<br>
<font color="#000000" face="helvetica, arial"><a name="calibration">class <strong>calibration</strong></a></font></td></tr>
    
<tr bgcolor="#ffc8d8"><td rowspan=2><tt>&nbsp;&nbsp;&nbsp;</tt></td>
<td colspan=2><tt>Container&nbsp;class&nbsp;for&nbsp;flat&nbsp;field&nbsp;<a href="#calibration">calibration</a>&nbsp;data.<br>&nbsp;</tt></td></tr>
<tr><td>&nbsp;</td>
<td width="100%">Methods defined here:<br>
<dl><dt><a name="calibration-__init__"><strong>__init__</strong></a>(self, calibration_data)</dt></dl>

<dl><dt><a name="calibration-plot"><strong>plot</strong></a>(self)</dt><dd><tt>Returns&nbsp;a&nbsp;matplotlib&nbsp;figure&nbsp;object&nbsp;(see&nbsp;matplotlib&nbsp;webpage)&nbsp;containing&nbsp;a&nbsp;plot&nbsp;of&nbsp;the&nbsp;<a href="#calibration">calibration</a><br>
data&nbsp;stored&nbsp;in&nbsp;the&nbsp;<a href="#calibration">calibration</a>&nbsp;object,&nbsp;angle&nbsp;from&nbsp;vertical&nbsp;against&nbsp;normalised&nbsp;flat&nbsp;field&nbsp;<br>
intensity.</tt></dd></dl>

<dl><dt><a name="calibration-save"><strong>save</strong></a>(self, filename)</dt><dd><tt>Saves&nbsp;the&nbsp;<a href="#calibration">calibration</a>&nbsp;data&nbsp;as&nbsp;a&nbsp;text&nbsp;file.&nbsp;This&nbsp;can&nbsp;be&nbsp;loaded&nbsp;using&nbsp;the&nbsp;fromFile&nbsp;function,&nbsp;<br>
meaning&nbsp;that&nbsp;<a href="#calibration">calibration</a>&nbsp;data&nbsp;should&nbsp;only&nbsp;need&nbsp;to&nbsp;be&nbsp;calculated&nbsp;once.</tt></dd></dl>

</td></tr></table> <p>
<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="section">
<tr bgcolor="#ffc8d8">
<td colspan=3 valign=bottom>&nbsp;<br>
<font color="#000000" face="helvetica, arial"><a name="variance">class <strong>variance</strong></a></font></td></tr>
    
<tr bgcolor="#ffc8d8"><td rowspan=2><tt>&nbsp;&nbsp;&nbsp;</tt></td>
<td colspan=2><tt>Container&nbsp;class&nbsp;for&nbsp;<a href="#variance">variance</a>&nbsp;data<br>&nbsp;</tt></td></tr>
<tr><td>&nbsp;</td>
<td width="100%">Methods defined here:<br>
<dl><dt><a name="variance-__init__"><strong>__init__</strong></a>(self, variances)</dt></dl>

<dl><dt><a name="variance-save"><strong>save</strong></a>(self, filename)</dt><dd><tt>Saves&nbsp;the&nbsp;<a href="#variance">variance</a>&nbsp;data&nbsp;as&nbsp;a&nbsp;text&nbsp;file.&nbsp;This&nbsp;can&nbsp;be&nbsp;loaded&nbsp;using&nbsp;the&nbsp;<a href="#-loadVariances">loadVariances</a>()&nbsp;function,&nbsp;<br>
meaning&nbsp;that&nbsp;<a href="#variance">variance</a>&nbsp;data&nbsp;should&nbsp;only&nbsp;need&nbsp;to&nbsp;be&nbsp;calculated&nbsp;once.</tt></dd></dl>

</td></tr></table></td></tr></table><p>
<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="section">
<tr bgcolor="#eeaa77">
<td colspan=3 valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial"><big><strong>Functions</strong></big></font></td></tr>
    
<tr><td bgcolor="#eeaa77"><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt></td><td>&nbsp;</td>
<td width="100%"><dl><dt><a name="-calculateVariances"><strong>calculateVariances</strong></a>(dataset)</dt><dd><tt>Calculates&nbsp;the&nbsp;mean&nbsp;and&nbsp;<a href="#variance">variance</a>&nbsp;of&nbsp;pixel&nbsp;values&nbsp;in&nbsp;all&nbsp;images&nbsp;in&nbsp;the&nbsp;specified&nbsp;dataset&nbsp;(where&nbsp;dataset&nbsp;<br>
is&nbsp;a&nbsp;dataset&nbsp;object)&nbsp;and&nbsp;returns&nbsp;a&nbsp;<a href="#variance">variance</a>&nbsp;object.</tt></dd></dl>
 <dl><dt><a name="-fromFile"><strong>fromFile</strong></a>(filename)</dt><dd><tt>Returns&nbsp;a&nbsp;<a href="#calibration">calibration</a>&nbsp;object&nbsp;created&nbsp;from&nbsp;<a href="#calibration">calibration</a>&nbsp;data&nbsp;stored&nbsp;in&nbsp;a&nbsp;text&nbsp;file.&nbsp;The&nbsp;text&nbsp;file&nbsp;should&nbsp;<br>
have&nbsp;two&nbsp;columns&nbsp;of&nbsp;numbers.&nbsp;The&nbsp;first&nbsp;should&nbsp;be&nbsp;the&nbsp;angle&nbsp;(integers&nbsp;running&nbsp;from&nbsp;0-90&nbsp;with&nbsp;a&nbsp;step&nbsp;size&nbsp;<br>
of&nbsp;1).&nbsp;The&nbsp;second&nbsp;should&nbsp;be&nbsp;the&nbsp;normalised&nbsp;flat&nbsp;field&nbsp;intensity&nbsp;at&nbsp;this&nbsp;angle&nbsp;(&lt;=1).&nbsp;These&nbsp;angles&nbsp;are&nbsp;<br>
degrees&nbsp;from&nbsp;vertical&nbsp;e.g.&nbsp;the&nbsp;first&nbsp;entry&nbsp;in&nbsp;the&nbsp;list&nbsp;is&nbsp;the&nbsp;correction&nbsp;factor&nbsp;for&nbsp;the&nbsp;centre&nbsp;of&nbsp;the&nbsp;<br>
image,&nbsp;0&nbsp;degrees&nbsp;from&nbsp;vertical.These&nbsp;angles&nbsp;should&nbsp;not&nbsp;be&nbsp;confused&nbsp;with&nbsp;the&nbsp;angles&nbsp;from&nbsp;horizontal&nbsp;or&nbsp;<br>
angles&nbsp;from&nbsp;North&nbsp;used&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;code.</tt></dd></dl>
 <dl><dt><a name="-fromImages"><strong>fromImages</strong></a>(dataset)</dt><dd><tt>Returns&nbsp;a&nbsp;<a href="#calibration">calibration</a>&nbsp;object&nbsp;created&nbsp;by&nbsp;finding&nbsp;the&nbsp;median&nbsp;intensities&nbsp;at&nbsp;different&nbsp;angles&nbsp;from&nbsp;vertical<br>
of&nbsp;a&nbsp;set&nbsp;of&nbsp;"flat&nbsp;field&nbsp;images"&nbsp;stored&nbsp;in&nbsp;the&nbsp;specified&nbsp;dataset&nbsp;object.&nbsp;These&nbsp;are&nbsp;images&nbsp;in&nbsp;which&nbsp;the<br>
sky&nbsp;is&nbsp;approximately&nbsp;evenly&nbsp;lit.&nbsp;These&nbsp;images&nbsp;should&nbsp;be&nbsp;chosen&nbsp;by&nbsp;looking&nbsp;for&nbsp;time&nbsp;periods&nbsp;with&nbsp;a&nbsp;low&nbsp;<br>
<a href="#variance">variance</a>&nbsp;using&nbsp;the&nbsp;<a href="#variance">variance</a>&nbsp;class.&nbsp;For&nbsp;each&nbsp;image&nbsp;in&nbsp;the&nbsp;dataset,&nbsp;this&nbsp;function&nbsp;takes&nbsp;slices&nbsp;through&nbsp;<br>
the&nbsp;center&nbsp;of&nbsp;the&nbsp;image&nbsp;between&nbsp;0-359&nbsp;degrees&nbsp;from&nbsp;North&nbsp;at&nbsp;1&nbsp;degree&nbsp;resolution.&nbsp;It&nbsp;then&nbsp;records&nbsp;the&nbsp;<br>
values&nbsp;of&nbsp;the&nbsp;intensities&nbsp;at&nbsp;angles&nbsp;0-90&nbsp;from&nbsp;the&nbsp;center.&nbsp;When&nbsp;this&nbsp;has&nbsp;been&nbsp;done&nbsp;for&nbsp;all&nbsp;images&nbsp;the&nbsp;<br>
median&nbsp;values&nbsp;of&nbsp;intensity&nbsp;for&nbsp;each&nbsp;angle&nbsp;from&nbsp;the&nbsp;centre&nbsp;are&nbsp;calculated.&nbsp;These&nbsp;are&nbsp;then&nbsp;normalised.</tt></dd></dl>
 <dl><dt><a name="-loadVariances"><strong>loadVariances</strong></a>(filename)</dt><dd><tt>Loads&nbsp;<a href="#variance">variance</a>&nbsp;data&nbsp;from&nbsp;a&nbsp;text&nbsp;file&nbsp;and&nbsp;returns&nbsp;a&nbsp;<a href="#variance">variance</a>&nbsp;object.&nbsp;The&nbsp;text&nbsp;file&nbsp;should&nbsp;have&nbsp;three&nbsp;<br>
columns:&nbsp;time,&nbsp;<a href="#variance">variance</a>,mean.&nbsp;Where&nbsp;time&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;days&nbsp;since&nbsp;the&nbsp;epoch&nbsp;(a&nbsp;float).</tt></dd></dl>
</td></tr></table>
</body></html>